
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Symptom Tracker</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        label { display: block; margin-top: 10px; }
        input, select, textarea { width: 100%; padding: 6px; margin-top: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        button { margin-right: 5px; }
    </style>
</head>
<body>
    <h1>Symptom Tracker</h1>
    <form id="tracker-form">
        <label>Date
            <input type="date" id="date" name="date">
        </label>
        <label>Primary Symptom
            <select id="primary-symptom" name="primary-symptom">
                <option value="PET">PET</option>
                <option value="ETD">ETD</option>
                <option value="Both">Both</option>
            </select>
        </label>
        
        <label>Symptoms</label>
        <label><input type="checkbox" name="symptoms" value="Autophony"> Autophony</label>
        <label><input type="checkbox" name="symptoms" value="Fullness"> Fullness</label>
        <label><input type="checkbox" name="symptoms" value="Popping"> Popping</label>
        <label><input type="checkbox" name="symptoms" value="Crackling"> Crackling</label>
        <label><input type="checkbox" name="symptoms" value="Squeaking"> Squeaking</label>
        <label><input type="checkbox" name="symptoms" value="Tinnitus"> Tinnitus</label>
        <label><input type="checkbox" name="symptoms" value="Feeling of movement/blockage"> Feeling of movement/blockage</label>
        <label><input type="checkbox" name="symptoms" value="Pressure"> Pressure</label>
        <label><input type="checkbox" name="symptoms" value="Muffled hearing"> Muffled hearing</label>
        <label><input type="checkbox" name="symptoms" value="Pain"> Pain</label>
        <label><input type="checkbox" name="symptoms" value="Clicking"> Clicking</label>
        <label><input type="checkbox" name="symptoms" value="Jaw Pain"> Jaw Pain</label>
        <input type="text" id="other-symptom" placeholder="Other symptom">

        <label><input type="checkbox" name="symptoms" value="Autophony"> Autophony</label>
        <label><input type="checkbox" name="symptoms" value="Fullness"> Fullness</label>
        <label><input type="checkbox" name="symptoms" value="Popping"> Popping</label>
        <label><input type="checkbox" name="symptoms" value="Crackling"> Crackling</label>
        <label><input type="checkbox" name="symptoms" value="Squeaking"> Squeaking</label>
        <label><input type="checkbox" name="symptoms" value="Tinnitus"> Tinnitus</label>
        <input type="text" id="other-symptom" placeholder="Other symptom">
        <label>Caffeine Intake
            <input type="text" id="caffeine" name="caffeine" placeholder="e.g. 1x coffee, 1x Coke">
        </label>
        <div>Estimated Caffeine (mg): <span id="caffeine-mg">0</span></div>
        <label>Water Intake (L)
            <input type="number" id="water" name="water" step="0.1">
        </label>
        <label>Sleep Quality
            <select id="sleep-quality" name="sleep-quality">
                <option value="">Select</option>
                <option value="Good">Good</option>
                <option value="Average">Average</option>
                <option value="Poor">Poor</option>
            </select>
        </label>
        <label>Sleep Hours (optional)
            <input type="number" id="sleep-hours" name="sleep-hours" step="0.1">
        </label>
        <label>Treatments Tried
            <textarea id="treatments" name="treatments"></textarea>
        </label>
        <label>Relief From Treatment
            <select id="relief" name="relief">
                <option value="">Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
            </select>
        </label>
        <label>Notes
            <textarea id="notes" name="notes"></textarea>
        </label>
        <button type="submit">Save Entry</button>
    </form>

    
    
    <h2>Saved Logs</h2>
    <label>Filter by Primary Symptom:
        <select id="filter-select">
            <option value="">Show All</option>
            <option value="PET">PET</option>
            <option value="ETD">ETD</option>
            <option value="Both">Both</option>
        </select>
    </label>
    <table>
        <thead>
            <tr>
                <th>Date</th><th>Primary</th><th>Symptoms</th><th>Caffeine</th><th>mg</th>
                <th>Water</th><th>Sleep Q.</th><th>Hours</th><th>Treatments</th><th>Relief</th><th>Notes</th><th>Actions</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

        <thead>
            <tr>
                <th>Date</th><th>Primary</th><th>Symptoms</th><th>Caffeine</th><th>mg</th>
                <th>Water</th><th>Sleep Q.</th><th>Hours</th><th>Treatments</th><th>Relief</th><th>Notes</th><th>Actions</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        const form = document.getElementById('tracker-form');
        const tableBody = document.getElementById('table-body');
        const caffeineInput = document.getElementById('caffeine');
        const caffeineMg = document.getElementById('caffeine-mg');
        let editIndex = null;

        function estimateCaffeine(input) {
            const map = { coffee: 95, coke: 34, tea: 47, espresso: 63, energy: 80 };
            let total = 0;
            const entries = input.toLowerCase().split(/[,\n]/);
            for (let item of entries) {
                let matched = false;
                for (let key in map) {
                    if (item.includes(key)) {
                        let count = parseInt(item) || 1;
                        total += count * map[key];
                        matched = true;
                        break;
                    }
                }
            }
            return total;
        }

        function renderLogs() {
            const filter = document.getElementById("filter-select").value;
            const logs = JSON.parse(localStorage.getItem('logs') || '[]');
            tableBody.innerHTML = '';
            logs.forEach((log, i) => {
                if (filter && log.primarySymptom !== filter) return;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${log.date}</td><td>${log.primarySymptom}</td><td>${log.symptoms.join(", ")}</td>
                    <td>${log.caffeine}</td><td>${log.caffeineMg}</td><td>${log.water}</td>
                    <td>${log.sleepQuality}</td><td>${log.sleepHours}</td><td>${log.treatments}</td>
                    <td>${log.relief}</td><td>${log.notes}</td>
                    <td>
                        <button onclick="editLog(${i})">Edit</button>
                        <button onclick="deleteLog(${i})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function deleteLog(index) {
            const logs = JSON.parse(localStorage.getItem('logs') || '[]');
            logs.splice(index, 1);
            localStorage.setItem('logs', JSON.stringify(logs));
            
    document.getElementById('filter-select').addEventListener('change', renderLogs);
    renderLogs();
    
        }

        function editLog(index) {
            const logs = JSON.parse(localStorage.getItem('logs') || '[]');
            const log = logs[index];
            editIndex = index;

            document.getElementById('date').value = log.date;
            document.getElementById('primary-symptom').value = log.primarySymptom;
            document.querySelectorAll('input[name="symptoms"]').forEach(cb => {
                cb.checked = log.symptoms.includes(cb.value);
            });
            document.getElementById('other-symptom').value = log.symptoms.find(s => 
                !Array.from(document.querySelectorAll('input[name="symptoms"]')).some(cb => cb.value === s)
            ) || '';
            document.getElementById('caffeine').value = log.caffeine;
            document.getElementById('water').value = log.water;
            document.getElementById('sleep-quality').value = log.sleepQuality;
            document.getElementById('sleep-hours').value = log.sleepHours;
            document.getElementById('treatments').value = log.treatments;
            document.getElementById('relief').value = log.relief;
            document.getElementById('notes').value = log.notes;
            caffeineMg.textContent = log.caffeineMg;
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            const formData = new FormData(form);
            const log = {
                date: formData.get("date"),
                primarySymptom: formData.get("primary-symptom"),
                symptoms: formData.getAll("symptoms").concat(formData.get("other-symptom") || "").filter(Boolean),
                caffeine: formData.get("caffeine"),
                caffeineMg: estimateCaffeine(formData.get("caffeine")),
                water: formData.get("water"),
                sleepQuality: formData.get("sleep-quality"),
                sleepHours: formData.get("sleep-hours"),
                treatments: formData.get("treatments"),
                relief: formData.get("relief"),
                notes: formData.get("notes")
            };
            const logs = JSON.parse(localStorage.getItem('logs') || '[]');
            if (editIndex !== null) {
                logs[editIndex] = log;
                editIndex = null;
            } else {
                logs.push(log);
            }
            localStorage.setItem('logs', JSON.stringify(logs));
            form.reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            caffeineMg.textContent = 0;
            
    document.getElementById('filter-select').addEventListener('change', renderLogs);
    renderLogs();
    
        });

        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            caffeineInput.addEventListener('input', () => {
                const est = estimateCaffeine(caffeineInput.value);
                caffeineMg.textContent = est;
            });
            
    document.getElementById('filter-select').addEventListener('change', renderLogs);
    renderLogs();
    
        });
    </script>
</body>
</html>
